<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <title>Boglehead Portfolio â€” Sverige</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    body { background: #f5f7fa; font-family: 'Helvetica Neue', Arial, sans-serif; -webkit-text-size-adjust: 100%; }
    #root { max-width: 430px; margin: 0 auto; min-height: 100vh; padding-bottom: 80px; }
    .topbar { background: #0f2744; padding: 16px 20px 12px; position: sticky; top: 0; z-index: 100; display: flex; justify-content: space-between; align-items: center; }
    .topbar-left h1 { color: white; font-size: 18px; font-family: Georgia, serif; font-weight: 700; }
    .topbar-left p { color: rgba(255,255,255,0.5); font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; margin-top: 2px; }
    .lang-toggle { display: flex; background: rgba(255,255,255,0.12); border-radius: 20px; overflow: hidden; flex-shrink: 0; }
    .lang-btn { border: none; background: transparent; color: rgba(255,255,255,0.6); font-size: 12px; font-weight: 700; padding: 6px 12px; cursor: pointer; }
    .lang-btn.active { background: #c9a84c; color: white; border-radius: 20px; }
    .tab-content { display: none; padding: 16px; flex-direction: column; gap: 16px; }
    .tab-content.active { display: flex; }
    .bottomnav { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 430px; background: white; border-top: 1px solid #eee; display: flex; box-shadow: 0 -4px 20px rgba(0,0,0,0.08); z-index: 100; }
    .nav-btn { flex: 1; padding: 10px 4px 8px; border: none; background: none; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 2px; }
    .nav-btn .icon { font-size: 20px; }
    .nav-btn .label { font-size: 10px; font-weight: 600; color: #aaa; letter-spacing: 0.04em; }
    .nav-btn.active .label { color: #0f2744; }
    .nav-btn .dot { width: 20px; height: 2px; background: #c9a84c; border-radius: 1px; display: none; }
    .nav-btn.active .dot { display: block; }
    .hero { background: linear-gradient(135deg, #0f2744 0%, #1a3d6b 100%); border-radius: 16px; padding: 20px; color: white; }
    .hero-row { display: flex; justify-content: space-between; align-items: flex-start; }
    .hero-label { font-size: 12px; opacity: 0.7; letter-spacing: 0.08em; text-transform: uppercase; margin-bottom: 4px; }
    .hero-value { font-size: 28px; font-family: Georgia, serif; font-weight: bold; }
    .hero-ter { font-size: 18px; color: #c9a84c; font-family: Georgia, serif; }
    .btn-row { display: flex; gap: 8px; margin-top: 10px; flex-wrap: wrap; }
    .pill-btn { padding: 8px 14px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3); cursor: pointer; font-size: 12px; background: transparent; color: rgba(255,255,255,0.8); }
    .pill-btn.cur { border: none; font-weight: 600; background: rgba(255,255,255,0.15); color: white; }
    .pill-btn.cur.active { background: #c9a84c; }
    .card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
    .fund-name { font-weight: 700; font-size: 15px; color: #0f2744; }
    .fund-sub { font-size: 12px; color: #888; margin-top: 2px; }
    .fund-ter { color: #c9a84c; font-weight: 600; }
    .fund-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
    .fund-status { text-align: right; font-size: 13px; color: #555; }
    .fund-diff { font-size: 12px; font-weight: 600; }
    .progress-wrap { height: 6px; background: #f0f0f0; border-radius: 3px; margin-bottom: 14px; position: relative; }
    .progress-bar { height: 100%; border-radius: 3px; transition: width 0.4s; }
    .progress-target { position: absolute; top: -3px; width: 2px; height: 12px; background: #333; border-radius: 1px; transform: translateX(-50%); }
    .fund-input { width: 100%; padding: 16px; border-radius: 12px; border: 2px solid #dde3ec; font-size: 20px; color: #0f2744; font-family: Georgia, serif; outline: none; -webkit-appearance: none; touch-action: manipulation; background: #fff; }
    .fund-desc { font-size: 12px; color: #aaa; margin-top: 8px; }
    .save-btn { background: #0f2744; color: white; border: none; border-radius: 12px; padding: 16px; font-size: 15px; font-weight: 700; cursor: pointer; width: 100%; }
    .save-btn:disabled { background: #ccc; cursor: default; }
    .warn-box { background: #fff3cd; border: 1px solid #ffc107; border-radius: 12px; padding: 14px; color: #856404; font-size: 14px; }
    .rebal-card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
    .rebal-row { display: flex; justify-content: space-between; align-items: center; }
    .rebal-amount { font-size: 20px; font-family: Georgia, serif; font-weight: bold; }
    .rebal-action { font-size: 12px; font-weight: 600; }
    .section-header { background: #0f2744; border-radius: 14px; padding: 16px; color: white; }
    .section-header h2 { font-size: 16px; font-weight: 700; font-family: Georgia, serif; }
    .section-header p { font-size: 12px; opacity: 0.7; margin-top: 2px; }
    .snap-card { background: white; border-radius: 14px; padding: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); }
    .snap-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    .snap-total { font-weight: 700; color: #0f2744; font-family: Georgia, serif; font-size: 18px; }
    .snap-date { font-size: 12px; color: #888; }
    .snap-del { background: none; border: none; color: #ccc; cursor: pointer; font-size: 18px; padding: 4px 8px; }
    .snap-line { display: flex; justify-content: space-between; font-size: 13px; color: #555; padding: 3px 0; border-top: 1px solid #f5f5f5; }
    .empty { text-align: center; color: #aaa; padding: 60px 20px; font-size: 15px; line-height: 1.8; }
    .faq-card { background: white; border-radius: 14px; box-shadow: 0 2px 12px rgba(0,0,0,0.07); overflow: hidden; }
    .faq-btn { width: 100%; padding: 16px; background: none; border: none; text-align: left; cursor: pointer; display: flex; justify-content: space-between; align-items: center; gap: 12px; }
    .faq-q { font-weight: 600; font-size: 14px; color: #0f2744; flex: 1; }
    .faq-icon { color: #888; font-size: 18px; flex-shrink: 0; }
    .faq-a { padding: 0 16px 16px; font-size: 14px; color: #444; line-height: 1.6; display: none; }
    .faq-a.open { display: block; }
    .comp-fund { padding: 12px; margin-bottom: 8px; border-radius: 10px; }
    .comp-fund.recommended { background: #f0f7ff; border: 1px solid #2d6a9f; }
    .comp-fund.other { background: #fafafa; border: 1px solid #eee; }
    .comp-row { display: flex; justify-content: space-between; align-items: flex-start; }
    .comp-name { font-weight: 700; font-size: 14px; color: #0f2744; }
    .comp-index { font-size: 12px; color: #888; margin-top: 2px; }
    .comp-ter { font-family: Georgia, serif; font-weight: 700; font-size: 16px; margin-left: 12px; }
    .comp-note { font-size: 12px; color: #666; margin-top: 6px; }
    .default-badge { background: #c9a84c; color: white; font-size: 10px; padding: 2px 7px; border-radius: 10px; margin-left: 6px; vertical-align: middle; }
    .preset-row { display: flex; gap: 10px; }
    .preset-btn { flex: 1; background: #f0f7ff; border: 1px solid #2d6a9f; border-radius: 10px; padding: 10px; font-size: 13px; font-weight: 600; color: #0f2744; cursor: pointer; }
    .alloc-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .alloc-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; }
    .alloc-name { flex: 1; font-size: 13px; color: #333; }
    .alloc-input { width: 64px; padding: 10px 8px; border-radius: 8px; border: 1px solid #e0e0e0; font-size: 16px; text-align: center; outline: none; }
    .alloc-pct { font-size: 14px; color: #888; }
    .alloc-total { text-align: right; font-weight: 700; font-size: 15px; margin-top: 4px; }
    .reset-btn { background: #fff0f0; border: 1px solid #ffcccc; border-radius: 14px; padding: 14px; font-size: 14px; color: #c0392b; cursor: pointer; width: 100%; }
    .reset-confirm { background: #fff0f0; border-radius: 14px; padding: 16px; border: 1px solid #ffcccc; }
    .reset-msg { font-weight: 700; color: #c0392b; margin-bottom: 10px; }
    .btn-pair { display: flex; gap: 8px; }
    .btn-danger { flex: 1; background: #c0392b; color: white; border: none; border-radius: 10px; padding: 12px; font-weight: 700; cursor: pointer; }
    .btn-cancel { flex: 1; background: #f5f5f5; border: none; border-radius: 10px; padding: 12px; font-weight: 700; cursor: pointer; color: #333; }
  </style>
</head>
<body>
<div id="root">
  <div class="topbar">
    <div class="topbar-left">
      <h1 id="app-title">Boglehead Portfolio</h1>
      <p id="app-subtitle"></p>
    </div>
    <div class="lang-toggle">
      <button class="lang-btn" id="lang-sv" onclick="setLang('sv')">SV</button>
      <button class="lang-btn" id="lang-en" onclick="setLang('en')">EN</button>
    </div>
  </div>

  <div id="tab-portfolio" class="tab-content active">
    <div class="hero">
      <div class="hero-row">
        <div>
          <div class="hero-label" id="lbl-total"></div>
          <div class="hero-value" id="hero-total">â€”</div>
        </div>
        <div style="text-align:right">
          <div class="hero-label" id="lbl-ter"></div>
          <div class="hero-ter" id="hero-ter">â€”</div>
        </div>
      </div>
      <div class="btn-row">
        <button class="pill-btn cur active" data-cur="SEK">SEK</button>
        <button class="pill-btn cur" data-cur="EUR">EUR</button>
        <button class="pill-btn cur" data-cur="USD">USD</button>
      </div>
      <div class="btn-row" id="preset-btns-hero"></div>
    </div>
    <div id="fund-cards"></div>
    <button class="save-btn" id="save-btn" onclick="saveSnapshot()" disabled></button>
  </div>

  <div id="tab-rebalance" class="tab-content">
    <div id="rebal-warn" class="warn-box" style="display:none"></div>
    <div class="hero" style="padding:16px">
      <div class="hero-label" id="lbl-rebal-header"></div>
      <div class="hero-value" id="rebal-total" style="font-size:22px"></div>
    </div>
    <div id="rebal-cards"></div>
  </div>

  <div id="tab-history" class="tab-content">
    <div id="history-content"></div>
  </div>

  <div id="tab-learn" class="tab-content">
    <div class="section-header">
      <h2 id="lbl-compare-title"></h2>
      <p id="lbl-compare-sub"></p>
    </div>
    <div id="comparison-cards"></div>
    <div class="section-header" style="margin-top:8px">
      <h2 id="lbl-faq-title"></h2>
    </div>
    <div id="faq-cards"></div>
  </div>

  <div id="tab-settings" class="tab-content">
    <div class="section-header"><h2 id="lbl-alloc-title"></h2></div>
    <div class="card">
      <div id="alloc-rows"></div>
      <div class="alloc-total" id="alloc-total"></div>
    </div>
    <div class="card">
      <div style="font-weight:700;color:#0f2744;margin-bottom:12px" id="lbl-preset-title"></div>
      <div class="preset-row" id="preset-btns-settings"></div>
    </div>
    <div id="reset-area"></div>
  </div>

  <nav class="bottomnav" id="bottomnav"></nav>
</div>

<script>
const T = {
  en: {
    appSubtitle:"Sweden Â· Three-Fund Strategy",
    totalPortfolio:"Total Portfolio", avgTer:"Avg TER",
    saveSnapshot:"ðŸ’¾ Save Snapshot",
    conservative:"Conservative", moderate:"Moderate", aggressive:"Aggressive",
    target:"Target", over:"â†‘ Over", under:"â†“ Under", ok:"âœ“ OK",
    enterValue:"Enter value in",
    rebalHeader:"Portfolio to rebalance",
    rebalEmpty:"Enter values in Portfolio tab first",
    rebalWarn:"âš  Targets sum to {n}% â€” should be exactly 100%",
    now:"Now", targetLabel:"Target", onTarget:"On target", buy:"Buy", sell:"Sell",
    noHistory:"No snapshots yet.\nSave one from the Portfolio tab.",
    growth:"Portfolio Growth",
    compareTitle:"Fund Comparison Guide", compareSub:"Three options per sector â€” tap to expand",
    faqTitle:"FAQ â€” Swedish Investor Guide",
    defaultBadge:"Default",
    allocTitle:"Target Allocations", totalLabel:"Total",
    presetTitle:"Apply Preset",
    resetBtn:"Reset to Defaults", resetConfirm:"Reset everything? This cannot be undone.",
    resetYes:"Yes, Reset", cancel:"Cancel",
    tabs:["Portfolio","Rebalance","History","Learn","Settings"],
    funds:[
      { name:"Avanza Global",                    desc:"Tracks MSCI World â€” 1,500+ companies across 23 developed markets. Zero management fee, only available via Avanza." },
      { name:"LÃ¤nsfÃ¶rsÃ¤kringar Europa Indexfond", desc:"Tracks MSCI Europe â€” broad exposure to 15 European countries. Most recommended European fund on Swedish forums." },
      { name:"AMF RÃ¤ntefond LÃ¥ng",                desc:"Long-duration SEK bonds â€” Swedish government and quality corporate bonds. Morningstar's Best Bond Fund 2024. True equity hedge." },
    ],
    comparison:[
      { sector:"ðŸŒ Global Equity", funds:[
        { name:"Avanza Global",                     index:"MSCI World",        ter:"0.00%", note:"Zero fee; only via Avanza; most popular in Sweden",       recommended:true  },
        { name:"LÃ¤nsfÃ¶rsÃ¤kringar Global IndexnÃ¤ra", index:"MSCI World",        ter:"0.22%", note:"Available everywhere; strong track record",               recommended:false },
        { name:"Swedbank Robur Access Global",      index:"MSCI World",        ter:"0.27%", note:"Good if banking with Swedbank",                           recommended:false },
      ]},
      { sector:"ðŸ‡ªðŸ‡º European Equity", funds:[
        { name:"Storebrand Europa A",               index:"MSCI Europe",       ter:"0.15%", note:"Cheapest Europe tracker in Sweden",                       recommended:false },
        { name:"LÃ¤nsfÃ¶rsÃ¤kringar Europa Indexfond", index:"MSCI Europe",       ter:"0.20%", note:"Most recommended on Swedish forums; widely available",    recommended:true  },
        { name:"SPP Aktiefond Europa",              index:"MSCI Europe",       ter:"0.24%", note:"Solid ESG focus",                                         recommended:false },
      ]},
      { sector:"ðŸ¦ Swedish Bonds", funds:[
        { name:"AMF RÃ¤ntefond LÃ¥ng",                index:"SEK Long-duration", ter:"0.10%", note:"Morningstar Best Bond Fund 2024; true equity hedge",      recommended:true  },
        { name:"SPP Obligationsfond",               index:"SEK Long-duration", ter:"0.20%", note:"Reliable, ESG-screened, 5-star Morningstar",              recommended:false },
        { name:"Spiltan RÃ¤ntefond Sverige âš ",       index:"SEK Short-duration",ter:"0.10%", note:"Corporate bonds â€” drops with stocks in a crash; less effective hedge", recommended:false },
      ]},
    ],
    faq:[
      { q:"What is a Boglehead three-fund portfolio?",            a:"Named after Vanguard founder John Bogle, this strategy holds just three low-cost index funds: global stocks, regional stocks, and bonds. The idea: you can't beat the market long-term, so don't try â€” just own it cheaply." },
      { q:"Why these three fund categories?",                     a:"Global equity (e.g. Avanza Global) gives you the whole world. European equity adds regional tilt without doubling global. Swedish bonds provide stability in SEK â€” your spending currency â€” and act as a cushion when stocks fall." },
      { q:"Why does the bond fund matter so much?",               a:"Not all bond funds behave the same in a crash. AMF RÃ¤ntefond LÃ¥ng holds long-duration government and quality corporate bonds â€” these tend to rise when stocks fall (flight to safety). Spiltan RÃ¤ntefond Sverige holds short-duration corporate bonds and typically falls alongside stocks. For true Boglehead risk management, use a long-duration fund." },
      { q:"What is TER (expense ratio)?",                         a:"Total Expense Ratio â€” the annual fee the fund takes from your investment. A 0.20% TER on 100,000 kr = 200 kr/year. Over 30 years, this compounds significantly. Every 0.10% saved per year is real money kept in your pocket." },
      { q:"What is rebalancing, and when should I do it?",        a:"Over time, strong performers grow beyond their target %. Rebalancing means selling a little of what grew and buying what lagged to return to your targets. Once or twice per year is enough â€” more often creates unnecessary transaction costs." },
      { q:"What is an ISK account?",                              a:"Investeringssparkonto â€” Sweden's special investment account taxed on a flat 'schablonbeskattning' (~0.375% of account value/year in 2024) instead of on actual gains. For most long-term investors, this is far cheaper than standard capital gains tax." },
      { q:"Conservative vs Moderate vs Aggressive â€” which is right for me?", a:"A rough guide: Conservative (more bonds) if you may need the money in under 5 years or can't sleep during crashes. Moderate for a 5â€“15 year horizon. Aggressive if you're investing for 15+ years and won't panic-sell during a market drop. Your temperament matters as much as your timeline." },
    ],
  },
  sv: {
    appSubtitle:"Sverige Â· Tre-fondsstrategi",
    totalPortfolio:"Total PortfÃ¶lj", avgTer:"Snitt TER",
    saveSnapshot:"ðŸ’¾ Spara Ã–gonblicksbild",
    conservative:"FÃ¶rsiktig", moderate:"Balanserad", aggressive:"Offensiv",
    target:"MÃ¥l", over:"â†‘ Ã–vervikt", under:"â†“ Undervikt", ok:"âœ“ OK",
    enterValue:"Ange vÃ¤rde i",
    rebalHeader:"PortfÃ¶lj att balansera",
    rebalEmpty:"Ange vÃ¤rden i PortfÃ¶lj-fliken fÃ¶rst",
    rebalWarn:"âš  MÃ¥lvikterna summerar till {n}% â€” ska vara exakt 100%",
    now:"Nu", targetLabel:"MÃ¥l", onTarget:"I balans", buy:"KÃ¶p", sell:"SÃ¤lj",
    noHistory:"Inga Ã¶gonblicksbilder Ã¤nnu.\nSpara en frÃ¥n PortfÃ¶lj-fliken.",
    growth:"PortfÃ¶ljutveckling",
    compareTitle:"Fondguide â€” JÃ¤mfÃ¶relse", compareSub:"Tre alternativ per kategori â€” tryck fÃ¶r att visa",
    faqTitle:"Vanliga frÃ¥gor â€” NybÃ¶rjarguide",
    defaultBadge:"Standard",
    allocTitle:"MÃ¥lvikter", totalLabel:"Totalt",
    presetTitle:"VÃ¤lj profil",
    resetBtn:"Ã…terstÃ¤ll till standard", resetConfirm:"Ã…terstÃ¤lla allt? Detta kan inte Ã¥ngras.",
    resetYes:"Ja, Ã¥terstÃ¤ll", cancel:"Avbryt",
    tabs:["PortfÃ¶lj","Balansera","Historik","LÃ¤r dig","InstÃ¤llningar"],
    funds:[
      { name:"Avanza Global",                    desc:"FÃ¶ljer MSCI World â€” 1 500+ bolag i 23 utvecklade marknader. Noll avgift, endast tillgÃ¤nglig via Avanza." },
      { name:"LÃ¤nsfÃ¶rsÃ¤kringar Europa Indexfond", desc:"FÃ¶ljer MSCI Europe â€” bred exponering mot 15 europeiska lÃ¤nder. Mest rekommenderade Europafonden pÃ¥ svenska forum." },
      { name:"AMF RÃ¤ntefond LÃ¥ng",                desc:"LÃ¥ng lÃ¶ptid i SEK â€” svenska stats- och kvalitetsobligationer. Morningstars bÃ¤sta rÃ¤ntefond 2024. Ger skydd nÃ¤r aktier faller." },
    ],
    comparison:[
      { sector:"ðŸŒ Global Aktier", funds:[
        { name:"Avanza Global",                     index:"MSCI World",       ter:"0,00%", note:"Noll avgift; endast via Avanza; mest populÃ¤r i Sverige",    recommended:true  },
        { name:"LÃ¤nsfÃ¶rsÃ¤kringar Global IndexnÃ¤ra", index:"MSCI World",       ter:"0,22%", note:"TillgÃ¤nglig Ã¶verallt; lÃ¥ng och stark meritlista",            recommended:false },
        { name:"Swedbank Robur Access Global",      index:"MSCI World",       ter:"0,27%", note:"Bra om du bankar hos Swedbank",                              recommended:false },
      ]},
      { sector:"ðŸ‡ªðŸ‡º Europeiska Aktier", funds:[
        { name:"Storebrand Europa A",               index:"MSCI Europe",      ter:"0,15%", note:"Billigaste Europafonden i Sverige",                           recommended:false },
        { name:"LÃ¤nsfÃ¶rsÃ¤kringar Europa Indexfond", index:"MSCI Europe",      ter:"0,20%", note:"Mest rekommenderad pÃ¥ svenska forum; brett tillgÃ¤nglig",      recommended:true  },
        { name:"SPP Aktiefond Europa",              index:"MSCI Europe",      ter:"0,24%", note:"Stark ESG-profil",                                            recommended:false },
      ]},
      { sector:"ðŸ¦ Svenska RÃ¤ntor", funds:[
        { name:"AMF RÃ¤ntefond LÃ¥ng",                index:"SEK LÃ¥ng lÃ¶ptid",  ter:"0,10%", note:"Morningstars bÃ¤sta rÃ¤ntefond 2024; skyddar nÃ¤r aktier faller", recommended:true  },
        { name:"SPP Obligationsfond",               index:"SEK LÃ¥ng lÃ¶ptid",  ter:"0,20%", note:"PÃ¥litlig, ESG-granskad, 5 stjÃ¤rnor Morningstar",              recommended:false },
        { name:"Spiltan RÃ¤ntefond Sverige âš ",       index:"SEK Kort lÃ¶ptid",  ter:"0,10%", note:"FÃ¶retagsobligationer â€” faller med aktier i en krasch; sÃ¤mre skydd", recommended:false },
      ]},
    ],
    faq:[
      { q:"Vad Ã¤r en Boglehead-portfÃ¶lj med tre fonder?",           a:"Strategin Ã¤r uppkallad efter Vanguards grundare John Bogle. Du hÃ¥ller tre billiga indexfonder: globala aktier, europeiska aktier och rÃ¤ntor. Tanken: du kan inte slÃ¥ marknaden pÃ¥ lÃ¥ng sikt, sÃ¥ fÃ¶rsÃ¶k inte â€” Ã¤g den billigt istÃ¤llet." },
      { q:"VarfÃ¶r just dessa tre kategorier?",                      a:"Globala aktier (t.ex. Avanza Global) ger dig hela vÃ¤rlden. Europeiska aktier lÃ¤gger till regional tyngd utan att dubbla globalt. Svenska rÃ¤ntor ger stabilitet i SEK â€” din konsumtionsvaluta â€” och fungerar som stÃ¶tdÃ¤mpare nÃ¤r aktier faller." },
      { q:"VarfÃ¶r spelar valet av rÃ¤ntefond sÃ¥ stor roll?",         a:"Alla rÃ¤ntefonder beter sig inte likadant i en krasch. AMF RÃ¤ntefond LÃ¥ng hÃ¥ller statsobligationer med lÃ¥ng lÃ¶ptid â€” dessa tenderar att stiga nÃ¤r aktier faller. Spiltan RÃ¤ntefond Sverige hÃ¥ller kortare fÃ¶retagsobligationer och faller ofta med aktier. VÃ¤lj lÃ¥ng lÃ¶ptid fÃ¶r Ã¤kta Boglehead-skydd." },
      { q:"Vad Ã¤r TER (fÃ¶rvaltningsavgift)?",                       a:"Total Expense Ratio â€” den Ã¥rliga avgift fonden tar frÃ¥n ditt kapital. En TER pÃ¥ 0,20% pÃ¥ 100 000 kr = 200 kr/Ã¥r. Ã–ver 30 Ã¥r rÃ¤ntar detta pÃ¥ rÃ¤nta. Varje 0,10% du sparar per Ã¥r Ã¤r riktiga pengar kvar i din ficka." },
      { q:"Vad Ã¤r rebalansering och hur ofta ska jag gÃ¶ra det?",    a:"Med tiden vÃ¤xer starka innehav fÃ¶rbi sin mÃ¥lvikt. Rebalansering innebÃ¤r att du sÃ¤ljer lite av det som vuxit och kÃ¶per mer av det som halkat efter. En till tvÃ¥ gÃ¥nger per Ã¥r rÃ¤cker â€” oftare skapar onÃ¶diga transaktionskostnader." },
      { q:"Vad Ã¤r ett ISK-konto?",                                  a:"Investeringssparkonto â€” ett sÃ¤rskilt sparkonto som beskattas med en schablonskatt (~0,375% av kontovÃ¤rdet per Ã¥r 2024) istÃ¤llet fÃ¶r pÃ¥ faktisk vinst. FÃ¶r de flesta lÃ¥ngsiktiga sparare Ã¤r detta mycket billigare Ã¤n vanlig kapitalvinstskatt." },
      { q:"FÃ¶rsiktig, Balanserad eller Offensiv â€” vad passar mig?", a:"En enkel guide: FÃ¶rsiktig om du kan behÃ¶va pengarna inom 5 Ã¥r. Balanserad fÃ¶r en horisont pÃ¥ 5â€“15 Ã¥r. Offensiv om du sparar i 15+ Ã¥r och inte sÃ¤ljer i panik nÃ¤r bÃ¶rsen faller. Ditt temperament spelar lika stor roll som din tidshorisont." },
    ],
  }
};

const DEFAULT_FUNDS = [
  { id:"global", ticker:"MSCI World",  ter:0.00, color:"#1e3a5f" },
  { id:"europe", ticker:"MSCI Europe", ter:0.20, color:"#2d6a9f" },
  { id:"bonds",  ticker:"SEK Bonds",   ter:0.10, color:"#c9a84c" },
];
const PRESETS = { conservative:[25,15,60], moderate:[48,12,40], aggressive:[65,20,15] };

function load(k,d){ try{ const s=localStorage.getItem(k); return s?JSON.parse(s):d; }catch{ return d; } }
function save(k,v){ try{ localStorage.setItem(k,JSON.stringify(v)); }catch{} }

let funds    = load("bf_funds",   DEFAULT_FUNDS);
let values   = load("bf_values",  {});
let targets  = load("bf_targets", {global:48,europe:12,bonds:40});
let currency = load("bf_currency","SEK");
let history  = load("bf_history", []);
let lang     = load("bf_lang",    "en");
let currentTab = "portfolio";

function t(k){ return T[lang][k]||T.en[k]||k; }
function parseNum(s){ if(!s) return 0; return parseFloat(String(s).replace(/[^0-9.]/g,""))||0; }
function fmt(v){
  const n=parseFloat(v); if((!v&&v!==0)||isNaN(n)) return "";
  if(currency==="SEK") return n.toLocaleString("sv-SE")+" kr";
  if(currency==="EUR") return "â‚¬"+n.toLocaleString("de-DE");
  return "$"+n.toLocaleString("en-US");
}
function tv(){ return funds.reduce((s,f)=>s+parseNum(values[f.id]),0); }
function wTER(){
  const t=tv();
  if(t>0) return funds.reduce((s,f)=>s+(parseNum(values[f.id])/t)*(f.ter||0),0);
  return funds.reduce((s,f)=>s+((parseNum(targets[f.id])||0)/100)*(f.ter||0),0);
}
function fname(i){ return (T[lang].funds[i]||{}).name||funds[i].id; }
function fdesc(i){ return (T[lang].funds[i]||{}).desc||""; }

function setLang(l){
  lang=l; save("bf_lang",lang);
  document.getElementById("lang-sv").classList.toggle("active",l==="sv");
  document.getElementById("lang-en").classList.toggle("active",l==="en");
  applyTranslations(); renderAll();
}

function applyTranslations(){
  document.getElementById("app-subtitle").textContent    = t("appSubtitle");
  document.getElementById("lbl-total").textContent       = t("totalPortfolio");
  document.getElementById("lbl-ter").textContent         = t("avgTer");
  document.getElementById("save-btn").textContent        = t("saveSnapshot");
  document.getElementById("lbl-rebal-header").textContent= t("rebalHeader");
  document.getElementById("lbl-compare-title").textContent=t("compareTitle");
  document.getElementById("lbl-compare-sub").textContent = t("compareSub");
  document.getElementById("lbl-faq-title").textContent   = t("faqTitle");
  document.getElementById("lbl-alloc-title").textContent = t("allocTitle");
  document.getElementById("lbl-preset-title").textContent= t("presetTitle");
  ["hero","settings"].forEach(loc=>{
    document.getElementById("preset-btns-"+loc).innerHTML=
      ["conservative","moderate","aggressive"].map(p=>
        `<button class="${loc==="hero"?"pill-btn":"preset-btn"}" onclick="applyPreset('${p}')">${t(p)}</button>`
      ).join("");
  });
  const labels=t("tabs");
  document.querySelectorAll(".nav-btn .label").forEach((el,i)=>{ if(labels[i]) el.textContent=labels[i]; });
  const ra=document.getElementById("reset-area");
  if(!ra.querySelector(".reset-confirm"))
    ra.innerHTML=`<button class="reset-btn" onclick="showResetConfirm()">${t("resetBtn")}</button>`;
  buildLearn();
}

function switchTab(id){
  currentTab=id;
  document.querySelectorAll(".tab-content").forEach(el=>el.classList.remove("active"));
  document.querySelectorAll(".nav-btn").forEach(el=>el.classList.remove("active"));
  document.getElementById("tab-"+id).classList.add("active");
  document.querySelector(`.nav-btn[data-tab="${id}"]`).classList.add("active");
  if(id==="rebalance") renderRebalance();
  if(id==="history")   renderHistory();
  if(id==="settings")  renderSettings();
}

function renderAll(){
  renderPortfolio();
  if(currentTab==="rebalance") renderRebalance();
  if(currentTab==="history")   renderHistory();
  if(currentTab==="settings")  renderSettings();
}

document.querySelectorAll(".pill-btn.cur").forEach(btn=>{
  btn.addEventListener("click",()=>{
    currency=btn.dataset.cur; save("bf_currency",currency);
    document.querySelectorAll(".pill-btn.cur").forEach(b=>b.classList.remove("active"));
    btn.classList.add("active"); renderPortfolio();
  });
});

function renderPortfolio(){
  const total=tv();
  document.getElementById("hero-total").textContent=total>0?fmt(total):"â€”";
  document.getElementById("hero-ter").textContent=wTER().toFixed(2)+"%/yr";
  document.getElementById("save-btn").disabled=total===0;
  document.querySelectorAll(".pill-btn.cur").forEach(b=>b.classList.toggle("active",b.dataset.cur===currency));
  const c=document.getElementById("fund-cards"); c.innerHTML="";
  funds.forEach((f,i)=>{
    const val=parseNum(values[f.id]);
    const ap=total>0?(val/total)*100:0, tp=parseNum(targets[f.id]), diff=ap-tp;
    const dc=diff>1.5?"#c0392b":diff<-1.5?"#2980b9":"#27ae60";
    const dt=(diff>0?"+":"")+diff.toFixed(1)+"% "+(diff>1.5?t("over"):diff<-1.5?t("under"):t("ok"));
    const card=document.createElement("div"); card.className="card"; card.style.borderLeft="4px solid "+f.color;
    card.innerHTML=`
      <div class="fund-header">
        <div><div class="fund-name">${fname(i)}</div>
          <div class="fund-sub">${f.ticker} Â· <span class="fund-ter">TER ${f.ter.toFixed(2)}%/yr</span></div></div>
        <div class="fund-status">${t("target")} <strong style="color:${f.color}">${tp}%</strong>
          <div class="fund-diff" style="color:${dc}">${dt}</div></div>
      </div>
      <div class="progress-wrap">
        <div class="progress-bar" style="width:${Math.min(ap,100)}%;background:${f.color}"></div>
        <div class="progress-target" style="left:${Math.min(tp,100)}%"></div>
      </div>
      <input class="fund-input" type="text" inputmode="decimal"
        placeholder="${t("enterValue")} ${currency}" value="${values[f.id]||""}" />
      <div class="fund-desc">${fdesc(i)}</div>`;
    card.querySelector("input").addEventListener("blur",e=>{
      values[f.id]=e.target.value.replace(/[^0-9.]/g,"");
      save("bf_values",values); renderPortfolio();
    });
    c.appendChild(card);
  });
}

function renderRebalance(){
  const total=tv(), ts=funds.reduce((s,f)=>s+parseNum(targets[f.id]),0);
  const w=document.getElementById("rebal-warn");
  if(ts!==100){ w.style.display="block"; w.textContent=t("rebalWarn").replace("{n}",ts); } else w.style.display="none";
  document.getElementById("rebal-total").textContent=total>0?fmt(total):t("rebalEmpty");
  const c=document.getElementById("rebal-cards"); c.innerHTML="";
  if(!total) return;
  funds.forEach((f,i)=>{
    const val=parseNum(values[f.id]), tv2=(parseNum(targets[f.id])/100)*total, diff=tv2-val;
    const ok=Math.abs(diff)<=500, col=ok?"#27ae60":diff>0?"#2980b9":"#c0392b";
    const card=document.createElement("div"); card.className="rebal-card"; card.style.borderLeft="4px solid "+f.color;
    card.innerHTML=`<div class="fund-name" style="margin-bottom:6px">${fname(i)}</div>
      <div class="rebal-row">
        <div style="font-size:13px;color:#555">
          <div>${t("now")}: <strong>${fmt(val)}</strong> (${((val/total)*100).toFixed(1)}%)</div>
          <div>${t("targetLabel")}: <strong>${fmt(tv2)}</strong> (${parseNum(targets[f.id])}%)</div>
        </div>
        <div style="text-align:right">
          <div class="rebal-amount" style="color:${col}">${ok?"âœ“":(diff>0?"+":"")+fmt(Math.abs(diff))}</div>
          <div class="rebal-action" style="color:${col}">${ok?t("onTarget"):diff>0?t("buy"):t("sell")}</div>
        </div>
      </div>`;
    c.appendChild(card);
  });
}

function saveSnapshot(){
  const total=tv(); if(!total) return;
  history.unshift({ date:new Date().toLocaleDateString("sv-SE"), total, currency,
    breakdown:funds.map((f,i)=>({ id:f.id, name:fname(i), value:parseNum(values[f.id]), pct:((parseNum(values[f.id])/total)*100).toFixed(1) }))
  });
  save("bf_history",history); switchTab("history");
}

function renderHistory(){
  const c=document.getElementById("history-content"); c.innerHTML="";
  if(!history.length){ c.innerHTML=`<div class="empty">${t("noHistory").replace("\n","<br>")}</div>`; return; }
  if(history.length>1){
    const pts=history.slice().reverse(), mx=Math.max(...pts.map(h=>h.total)), w=pts.length*60;
    const d=document.createElement("div"); d.style.cssText="background:#0f2744;border-radius:14px;padding:16px;margin-bottom:16px";
    d.innerHTML=`<div style="font-size:12px;color:rgba(255,255,255,0.6);text-transform:uppercase;letter-spacing:0.08em;margin-bottom:12px">${t("growth")}</div>
      <svg width="100%" height="80" viewBox="0 0 ${w} 80" preserveAspectRatio="none">
        <polyline points="${pts.map((h,i)=>`${i*60+30},${80-(h.total/mx)*70}`).join(" ")}" fill="none" stroke="#c9a84c" stroke-width="2.5" stroke-linejoin="round"/>
        ${pts.map((h,i)=>`<circle cx="${i*60+30}" cy="${80-(h.total/mx)*70}" r="4" fill="#c9a84c"/>`).join("")}
      </svg>`; c.appendChild(d);
  }
  history.forEach((snap,i)=>{
    const card=document.createElement("div"); card.className="snap-card";
    card.innerHTML=`<div class="snap-header">
        <div><div class="snap-total">${fmt(snap.total)}</div><div class="snap-date">${snap.date}</div></div>
        <button class="snap-del">âœ•</button></div>
      ${(snap.breakdown||[]).map(b=>`<div class="snap-line"><span>${b.name}</span><span>${fmt(b.value)} <span style="color:#888">(${b.pct}%)</span></span></div>`).join("")}`;
    card.querySelector(".snap-del").addEventListener("click",()=>{ history.splice(i,1); save("bf_history",history); renderHistory(); });
    c.appendChild(card);
  });
}

function buildLearn(){
  const cc=document.getElementById("comparison-cards"); cc.innerHTML="";
  T[lang].comparison.forEach(sec=>{
    const w=document.createElement("div"); w.className="faq-card";
    w.innerHTML=`<button class="faq-btn" onclick="toggleFaq(this)"><span class="faq-q">${sec.sector}</span><span class="faq-icon">+</span></button>
      <div class="faq-a" style="padding:0 16px 16px">${sec.funds.map(f=>`
        <div class="comp-fund ${f.recommended?"recommended":"other"}">
          <div class="comp-row"><div style="flex:1">
            <div class="comp-name">${f.name}${f.recommended?` <span class="default-badge">${t("defaultBadge")}</span>`:""}</div>
            <div class="comp-index">${f.index}</div></div>
            <div class="comp-ter" style="color:${parseFloat(f.ter)===0?"#27ae60":parseFloat(f.ter)<=0.15?"#2d6a9f":"#555"}">${f.ter}</div></div>
          <div class="comp-note">${f.note}</div></div>`).join("")}</div>`;
    cc.appendChild(w);
  });
  const fc=document.getElementById("faq-cards"); fc.innerHTML="";
  T[lang].faq.forEach(item=>{
    const w=document.createElement("div"); w.className="faq-card";
    w.innerHTML=`<button class="faq-btn" onclick="toggleFaq(this)"><span class="faq-q">${item.q}</span><span class="faq-icon">+</span></button>
      <div class="faq-a">${item.a}</div>`;
    fc.appendChild(w);
  });
}

function toggleFaq(btn){
  const b=btn.nextElementSibling; b.classList.toggle("open");
  btn.querySelector(".faq-icon").textContent=b.classList.contains("open")?"âˆ’":"+";
}

function renderSettings(){
  const c=document.getElementById("alloc-rows"); c.innerHTML="";
  funds.forEach((f,i)=>{
    const row=document.createElement("div"); row.className="alloc-row";
    row.innerHTML=`<div class="alloc-dot" style="background:${f.color}"></div>
      <div class="alloc-name">${fname(i)}</div>
      <input class="alloc-input" type="text" inputmode="decimal" value="${targets[f.id]||0}" />
      <span class="alloc-pct">%</span>`;
    const inp=row.querySelector("input");
    inp.addEventListener("input",updateAllocTotal);
    inp.addEventListener("blur",()=>{ targets[f.id]=parseFloat(inp.value)||0; save("bf_targets",targets); updateAllocTotal(); renderPortfolio(); });
    c.appendChild(row);
  });
  updateAllocTotal();
}

function updateAllocTotal(){
  const sum=Array.from(document.querySelectorAll(".alloc-input")).reduce((s,i)=>s+(parseFloat(i.value)||0),0);
  const el=document.getElementById("alloc-total");
  el.textContent=t("totalLabel")+": "+sum+"%"; el.style.color=sum===100?"#27ae60":"#c0392b";
}

function applyPreset(name){
  const vals=PRESETS[name]; funds.forEach((f,i)=>{ targets[f.id]=vals[i]!==undefined?vals[i]:0; });
  save("bf_targets",targets); renderPortfolio(); renderSettings();
}

function showResetConfirm(){
  document.getElementById("reset-area").innerHTML=`<div class="reset-confirm">
    <div class="reset-msg">${t("resetConfirm")}</div>
    <div class="btn-pair">
      <button class="btn-danger" onclick="doReset()">${t("resetYes")}</button>
      <button class="btn-cancel" onclick="cancelReset()">${t("cancel")}</button>
    </div></div>`;
}
function cancelReset(){
  document.getElementById("reset-area").innerHTML=`<button class="reset-btn" onclick="showResetConfirm()">${t("resetBtn")}</button>`;
}
function doReset(){
  funds=JSON.parse(JSON.stringify(DEFAULT_FUNDS)); values={}; targets={global:48,europe:12,bonds:40}; history=[];
  save("bf_funds",funds); save("bf_values",values); save("bf_targets",targets); save("bf_history",history);
  cancelReset(); renderAll(); switchTab("portfolio");
}

// Build nav
const tabIds=["portfolio","rebalance","history","learn","settings"];
const icons=["ðŸ“Š","âš–ï¸","ðŸ“ˆ","ðŸ“š","âš™ï¸"];
document.getElementById("bottomnav").innerHTML=tabIds.map((id,i)=>`
  <button class="nav-btn${id==="portfolio"?" active":""}" data-tab="${id}" onclick="switchTab('${id}')">
    <span class="icon">${icons[i]}</span><span class="label"></span><div class="dot"></div>
  </button>`).join("");

// Init
document.getElementById("lang-sv").classList.toggle("active",lang==="sv");
document.getElementById("lang-en").classList.toggle("active",lang==="en");
applyTranslations();
renderPortfolio();
renderSettings();
</script>
</body>
</html>
